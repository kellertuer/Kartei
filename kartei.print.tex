%
%    * ----------------------------------------------------------------
%    * "THE BEER-WARE LICENSE" (Revision 42/023):
%    * Ronny Bergmann <mail@rbergmann.info> wrote this file. As long as
%    * you retain this notice you can do whatever you want with this
%    * stuff. If we meet some day and you think this stuff is worth it,
%    * you can buy me a beer or a coffee in return.
%    * ----------------------------------------------------------------
%
%
% Kartei Source Code of the print option commands and
% pagestyle initializations
%
%   -- Version 1.9 --
%
% Last Change: Kartei 1.9, 2012/01/04
%
% An english manual will be available soon, up to that, at least all
% comments are in english
%
\makeatletter
\AtBeginShipout{%
\setbox\AtBeginShipoutBox\hbox{
  \ifthenelse{\isodd{\thepage}}%
  {%
    \begin{tikzpicture}[remember picture,yshift=-3in]%
      \path [use as bounding box] node [inner sep=0pt,outer sep=0pt] (A) {\box\AtBeginShipoutBox};
      \ifcard@useFrontgrid%
        %vertical lines
        \draw[front grid] (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset-.5\paperheight) -- (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset+.5\paperheight);%
        \draw[front grid] (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset-.5\paperheight) -- (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset+.5\paperheight);%
        % horizontal lines
        \draw[front grid] (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset-.5\paperheight) -- (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset-.5\paperheight);%
        \draw[front grid] (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset+.5\paperheight) -- (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset+.5\paperheight);%
      \fi%
    \end{tikzpicture}%
  }%
  {%
    \begin{tikzpicture}[remember picture]%
      \path [use as bounding box] node [inner sep=0pt,outer sep=0pt] (A) {\box\AtBeginShipoutBox};
      \ifcard@useReargrid%
        %vertical lines
        \draw[rear grid] (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset-.5\paperheight) -- (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset+.5\paperheight);%
        \draw[rear grid] (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset-.5\paperheight) -- (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset+.5\paperheight);%
        % horizontal lines
        \draw[rear grid] (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset-.5\paperheight) -- (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset-.5\paperheight);%
        \draw[rear grid] (\card@hoffset-.5\paperwidth-0.75pt,\card@voffset+.5\paperheight) -- (\card@hoffset+.5\paperwidth+0.75pt,\card@voffset+.5\paperheight);%
      \fi%
    \end{tikzpicture}%
  }%
}}

%
%
%
\ifcase \card@papersize%
%0 is A5
    \ifcase \card@Rearsiderotation% no rotation =0
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA5}[a4paper, border shrink=0mm]}%
    \or %rotate=1
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA5rotation}[a4paper, border shrink=0mm]}%
    \fi
  \or
%1 is A6
    \ifcase \card@Rearsiderotation% no rotation =0
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA6}[a4paper, landscape, border shrink=0mm]}%
    \or %rotate=1
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA6rotation}[a4paper, landscape, border shrink=0mm]}%
    \fi
  \or
%DIN A7 because 2
    \ifcase \card@Rearsiderotation% no rotation =0
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA7}[a4paper, border shrink=0mm]}%
    \or %rotate=1
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA7rotation}[a4paper, border shrink=0mm]}%
    \fi
  \or
  %DIN A8 because 3
    \ifcase \card@Rearsiderotation% no rotation =0
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA8}[a4paper, landscape, border shrink=0mm]}%
    \or %rotate=1
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA8rotation}[a4paper, landscape, border shrink=0mm]}%
    \fi
  \or
  %DIN A9 because 4
    \ifcase \card@Rearsiderotation% no rotation =0
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA9}[a4paper, border shrink=0mm]}%
    \or %rotate=1
      \renewcommand{\setcardpagelayout}{\pgfpagesuselayout{cardprintA9rotation}[a4paper, border shrink=0mm]}%
    \fi
\fi

%
% include all neccessary helper files
%
\input{kartei.pageshipout}

\input{kartei.a5printstyle}
\input{kartei.a5printstylerotation}
\input{kartei.a6printstyle}
\input{kartei.a6printstylerotation}
\input{kartei.a7printstyle}
\input{kartei.a7printstylerotation}
\input{kartei.a8printstyle}
\input{kartei.a8printstylerotation}
\input{kartei.a9printstyle}
\input{kartei.a9printstylerotation}
\makeatother